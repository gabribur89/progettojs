<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Uso un font da google -->
	<link href="https://fonts.googleapis.com/css?family=Dokdo" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<title>Benvenuto!</title>
  </head>
<body>
    <div class="container">
	<h1>Calcolatrice</h1>
		<div class="row" style="padding: 5px; border:5px solid black; width: 400px;">
			<div class="col-" id="schermo">
				<div id="ris"><p>0</p></div>
				<div id="prec"><p>0</p></div>
			</div>
		</div>
		<div class="row">
			<div class="col-"><button class="btn btn-primary" id="^" style="width: 100px;">x^y</button></div>
			<div class="col-"><button class="btn btn-danger" id="ce" style="width: 100px;">CE</button></div>
			<div class="col-"><button class="btn btn-danger" id="ac" style="width: 100px;">AC</button></div>
			<div class="col-"><button class="btn btn-warning" id="/" style="width: 100px;">/</button></div>
		</div>
		<div class="row">
			<div class="col-"><button class="btn btn-primary" id="7" value="7" style="width: 100px;">7</button></div>
			<div class="col-"><button class="btn btn-primary" id="8" value="8" style="width: 100px;">8</button></div>
			<div class="col-"><button class="btn btn-primary" id="9" value="9" style="width: 100px;">9</button></div>
			<div class="col-"><button class="btn btn-warning" id="+" style="width: 100px;">+</button></div>
		</div>
		<div class="row">
			<div class="col-"><button class="btn btn-primary" id="4" value="4" style="width: 100px;">4</button></div>
			<div class="col-"><button class="btn btn-primary" id="5" value="5" style="width: 100px;">5</button></div>
			<div class="col-"><button class="btn btn-primary" id="6" value="6" style="width: 100px;">6</button></div>
			<div class="col-"><button class="btn btn-warning" id="-" style="width: 100px;">-</button></div>
		</div>
		<div class="row">
			<div class="col-"><button class="btn btn-primary" id="1" value="1" style="width: 100px;">1</button></div>
			<div class="col-"><button class="btn btn-primary" id="2" value="2" style="width: 100px;">2</button></div>
			<div class="col-"><button class="btn btn-primary" id="3" value="3" style="width: 100px;">3</button></div>
			<div class="col-"><button class="btn btn-warning" id="*" style="width: 100px;">*</button></div>
		</div>
		<div class="row">
			<div class="col-"><button class="btn btn-primary" id="0" value="0" style="width: 200px;">0</button></div>
			<div class="col-"><button class="btn btn-warning" id="." style="width: 100px;">.</button></div>
			<div class="col-"><button class="btn btn-success" id="=" style="width: 100px;">=</button></div>
		</div>
	</div>
	<br>
	<button type="button" class="btn btn-info" id="tornahome">Torna alla Homepage</button>
</body>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>
function applicaPreferenze(){
	var user = JSON.parse(localStorage.getItem('user'));
	$('#titolo').attr("class","visible");
	$('#name').html(user.username);
	console.log(user);
	$('body').css("background-color", user.background);
	$('body').css("font-size", user.dimension);
	$('body').css("font-family", user.type); 
	$('body').css("color", user.color);
	if (user.menu == "sin")
		{
			$('#menuHome').removeClass("order-2").addClass("order-1");
			$('#bodyHome').removeClass("order-1").addClass("order-2");
		}
	else
		{
			$('#menuHome').removeClass("order-1").addClass("order-2");
			$('#bodyHome').removeClass("order-2").addClass("order-1");
		}
}

function miaeval(equazione){
    console.log(equazione);

    for (var i = 0; i < equazione.length; i++){ 
        console.log(equazione.charAt(i));    
    }
    
}
    
$(document).ready(function() {

if (localStorage.getItem('user') === null)
	{
		alert("Errore, devi registrarti con i tuoi dati");
		window.location.replace("index.html");
		//$('#btnreg').attr("class","visible");
	}
else
	applicaPreferenze();
		
  var equazione = ""; //tramite i button, prende anche l'operazione come stringa
  var display_calc = ""; // mostra sullo schermo della calcolatrice l'equazione
  var numerocorrente=""; //tramite i button (solo cifre), visualizza il numero inserito come stringa
  var risultato = "";
  var valoreinserito = ""; //rappresenta il valore che inserisco tramite i button, numero o segno che sia
  var reset = false;

  // variabili speciali per il caso potenza
  var op1;
  var op2;
  var potenzaOp = false;

  $("button").click(function() {    
    valoreinserito = $(this).attr("id");
	

	/*console.log("equazione:",equazione);
	console.log("numerocorrente:",numerocorrente);
	console.log("risultato:",risultato);
	console.log("valoreinserito:",valoreinserito);
	console.log("reset:",reset);*/


    if (valoreinserito === "^"){
       //op1 = equazione.charAt(equazione.length-1);
	   op1 = numerocorrente;
       potenzaOp = true;
       console.log("sono in potenza",numerocorrente);
       console.log(op1);
    }



    if (valoreinserito === "ac") {
      valoreinserito="0";
      equazione="0";
      risultato="0";
      numerocorrente="0";
      potenzaOp = false;
	  display_calc = 0;
      $('#ris p').html(valoreinserito);
      $('#prec p').html(display_calc);
	  console.log($('#ris p'));
	  console.log($('#prec p'));
    }
    
    else if (valoreinserito === "ce") {
      if (equazione.length > 1) {
        equazione = equazione.slice(0, -1); //elimina l'ultimo elemento inserito
		display_calc = equazione;
        $('#prec p').html(display_calc);
		console.log($('#prec p').html(display_calc));
      }
      else {
        equazione = 0;  
        $('#ris p').html(0);
		//console.log($('#ris p').html(0));
      }
      
      $('#prec p').html(equazione);
	  console.log($('#prec p').html(display_calc));
      
      if (numerocorrente.length > 1) {
	    console.log("maggiore di uno");
        numerocorrente = numerocorrente.slice(0, -1);        
        $('#ris p').html(numerocorrente);
		//console.log($('#prec p').html(equazione));
      }
      else {
        numerocorrente = 0;  
        //console.log($('#ris p').html(0));
      }
      
    }
   
    else if (valoreinserito === "=") {
      risultato = eval(equazione);
	  console.log("risultato eval(equazione) dopo =",risultato);
	  
      $('#ris p').html(risultato);
	  
      display_calc += "="+risultato;
	  
      $('#prec p').html(display_calc);
	  
      equazione = risultato;
	  console.log("equazione dopo =", equazione);
      valoreinserito = risultato;
	  console.log("valoreinserito dopo =",valoreinserito);
      numerocorrente = risultato;
	  console.log("numerocorrente dopo =",numerocorrente);
      reset = true;
	  console.log("reset dopo =", reset);
    }
    
    else if (isNaN(valoreinserito)) {   //check if is not a number, and after that, prevents for multiple "." to enter the same number
      if (valoreinserito !== ".") {     
        reset = false;     
		// primo inserimento 
        if (numerocorrente === 0 || equazione === 0) { 
          numerocorrente = 0;
          equazione = valoreinserito;         
        }
		// concatena il nuovo elemento a equazione
        else {
          numerocorrente = "";
          equazione += valoreinserito;
        }     
		// aggiorna
        $('#prec p').html(equazione); 
      }
	  // ho inserito la virgola
      else if (numerocorrente.indexOf(".") === -1) { 
        reset = false;
        if (numerocorrente === 0 || equazione === 0) { 
          numerocorrente = 0.;
          equazione = 0.;           
        }
        else {
          numerocorrente += valoreinserito;
          equazione += valoreinserito;        
        }
        $('#ris p').html(numerocorrente);
        $('#prec p').html(display_calc);        
      }      
    }
    // inserimento in ogni altro caso    
    else { 
       // resetto se ho pigiato AC	
      if (reset) {
	    console.log("resetto");
        equazione = valoreinserito;
        numerocorrente = valoreinserito;       
        reset = false;
      }
      else {
		console.log("inserisco:", valoreinserito);
        if (equazione.charAt(0) === '0'){
		equazione = valoreinserito;
		numerocorrente = valoreinserito;
		}
		else {
		equazione += valoreinserito; 
		numerocorrente += valoreinserito;
		}
  
		display_calc = equazione;
          
        if (potenzaOp){
           console.log("ho attivato operatore potenza",numerocorrente);
           //op2 = equazione.charAt(equazione.length-1);
		   op2 = numerocorrente;
           var potenza_res = Math.pow(op1, op2);
           //console.log(potenza_res);
		   console.log("lung:", op1.length, op2.length);
		   var lops = op1.length+op2.length+1;
		   console.log("ltot:" , lops);
           equazione = equazione.slice(0,-lops) + potenza_res;
           potenzaOp = false;
           console.log(equazione);
        }
		
       }
       $('#prec p').html(display_calc); 
       $('#ris p').html(numerocorrente);
      }   
    
    
    if (numerocorrente.length > 10 || equazione.length > 26) {
      $("#ris p").html("0");
      $("#prec p").html("troppe cifre inserite");
      numerocorrente ="";
      equazione="";
      risultato ="";
      reset=true;
    }
    console.log("risultato fine",risultato);
    /*if (risultato.toString().indexOf(".") !== -1) {
      risultato = risultato.truncate()
    }*/
    
  });
  
  	$('#tornahome').click(function (){
		window.location='homepage.html';
	});
    

});
</script>
</body>
</html>
